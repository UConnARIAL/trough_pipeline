# ===================== Shared / Global =====================
[project]
name = "AK_TCN"
version = "2026.01"
id_version = "v1.0-deterministic-rcsorted-neighsorted-compsorted"

[crs]
target_epsg = 3338
default_pixel_m = 0.5

[runtime]
# Used as defaults; each step can override under [steps.<name>.runtime]
workers = 0                # 0 = auto
hard_max_workers = 32
max_gb_per_worker = 64
openblas_threads = 1
omp_threads = 1

[io]
# These are common across steps
model_mask_dir = "../TCN_refac_test_imgs_model/" # dir that contains ML model outputs (raw detections bef any filtering)
master_dir = "../TCN_refac_test_imgs/"       # cleaned inputs that step1 reads
output_root = "../TCN_refac_test_gpkgs"      # GPKG outputs rooted read/write
mosaic_gpkg = "../TCN_refac_test_gpkgs/global_summary.gpkg" #name/path of the final global summary gpkg
ocean_mask_shp = "../water_3413_clip2.gpkg"     # Ocean mask to be used to filter masks
ocean_mask_layer = "water_clip"

# Convenience subfolders (steps can override if needed)
output_tiles_dir = "../TCN_refac_test_gpkgs"   # step1 writes per-file gpkg under tile_id/
tile_out_dir    = "./outputs/tiles"      # step2 could write per-tile gpkg
global_out_dir  = "./outputs/global"     # step3 could write global gpkg / reports

[layers]
nodes      = "GraphTheoreticNodes"
edges      = "GraphTheoreticEdges"
components = "GraphTheoreticComponents"
cutlines   = "InputMosaicCutlinesVector"

[cutlines]
enabled = true
root = "/scratch2/projects/PDG_shared/AlaskaTundraMosaic/imagery"
filename_pattern = "ArcticMosaic_{tile_id}_cutlines.shp"

[masks]
# original mask store used by step1 packaging
old_gpkg_root = "/scratch2/projects/PDG_shared/AK_TCN_Masks_only/" #not required
postfix = "_mask.tif"

[vectorize]
target_srs = "EPSG:3338"
assume_src_srs = "EPSG:3413"
build_overviews = [2, 4, 8, 16]
eight_connected = true
min_area = 0.5
simplify_tol = 0.25

[exposure]
enabled = true
cutline_layer = "InputMosaicCutlinesVector"
date_field = "ACQDATE"
mean_month = 7
mean_day = 15
sigma_days = 45
edges_length_field = "length_m"
comps_length_field = "total_length_m"
target_crs = "EPSG:3338"

# ===================== Step 1: Subtile processing =====================
[steps.mask_filter]
enabled = true
water_shp = "/path/water.gpkg"          # OR water_geojson
ocean_threshold = 0.99
buffer_m = 500.0
simplify_m = 0.0
max_workers = 0                        # 0=auto (like other steps)
gdal_cache_mb = 128
link_mode = "symlink"
overwrite_existing = false
include_dropped = false
absolute_symlinks = false
out_csv = "ocean_filter.csv"
out_drop = "drop_tiles.txt"
out_boundary = "boundary_tiles.txt"
log_every = 50


[steps.subtile]
enabled = true
tifs_per_run = 35
comps_heartbeat = 20000

# Optional filters for debugging/CI-like runs (step can override via CLI too)
[steps.subtile.select]
one_tile = ""         # empty means disabled
one_tif = false
limit_tifs = 0        # 0 means unlimited

# ===================== Step 2: Tile aggregation (future) =====================
[steps.tile]
enabled = false
# input will likely be [io.subtile_out_dir], output [io.tile_out_dir]
# add any tile-specific thresholds/fields later

# ===================== Step 3: Global summary (future) =====================
[steps.global]
enabled = false
# output might be [io.global_out_dir]
